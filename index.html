<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GITADORA GALAXY WAVE DELTA Drummania Settings Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }
        .lang-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 999;
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group label {
            display: inline-block;
            width: 200px;
        }
        .input-group input {
            width: 100px;
            padding: 5px;
        }
        .input-group input[readonly] {
            background-color: #e0e0e0;
            cursor: not-allowed;
        }
        .history {
            border: 1px solid #ccc;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .notes {
            font-size: 0.9em;
            color: #555;
            margin-top: 20px;
        }
        h1, h2 {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="lang-toggle">
        <button onclick="toggleLanguage()">English / 日本語</button>
    </div>
    <div class="modal" id="modal">
        <div class="modal-content">
            <p id="modal-text">For Sight Readers or New Players Only<br>Tap OK to Proceed</p>
            <button onclick="closeModal()">OK</button>
        </div>
    </div>
    <h1 id="title">GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</h1>
    <h2 id="subtitle">Set the shutter top as the judgment line to disable delay.</h2>
    <div class="input-group">
        <label id="bpm-label">BPM:</label>
        <input type="number" id="bpm" step="1" min="78" max="400" value="180">
    </div>
    <div class="input-group">
        <label id="hi-speed-label">HI-SPEED:</label>
        <input type="number" id="hi-speed" step="0.25" min="0.5" max="10.0" value="3.75">
    </div>
    <div class="input-group">
        <label id="green-number-label">Green Number:</label>
        <input type="number" id="green-number" step="1">
    </div>
    <div class="input-group">
        <label id="white-number-label">White Number:</label>
        <input type="number" id="white-number" readonly>
    </div>
    <div class="input-group">
        <label id="note-adjust-label">Note Display Adjustment:</label>
        <input type="number" id="note-adjust" readonly value="-6">
    </div>
    <div class="input-group">
        <label id="judge-line-label">Judgment Line Position:</label>
        <input type="number" id="judge-line" readonly value="8">
    </div>
    <div class="input-group">
        <label id="shutter-in-label">SHUTTER (IN):</label>
        <input type="number" id="shutter-in" readonly value="25">
    </div>
    <div class="input-group">
        <label id="shutter-out-label">SHUTTER (OUT):</label>
        <input type="number" id="shutter-out" readonly value="16">
    </div>
    <div class="input-group">
        <label id="refresh-rate-label">Refresh Rate (Hz):</label>
        <input type="number" id="refresh-rate" readonly value="60">
    </div>
    <div class="input-group">
        <label id="monitor-delay-label">Monitor Delay (ms):</label>
        <input type="number" id="monitor-delay" readonly value="9">
    </div>
    <div class="notes" id="notes">
        <p>Notes:</p>
        <ul>
            <li>Konaste's HI-SPEED adjustment is in 0.5 units.</li>
            <li>The default monitor for GITADORA GALAXY WAVE DELTA is assumed to have a 9ms delay.</li>
            <li>Sound depth balance varies by song; use headphones for zero audio delay.</li>
            <li>HI-SPEED: x3.75 at BPM: 180 is the limit for stable note display.</li>
        </ul>
    </div>
    <div class="history" id="history">
        <p>Change History:</p>
    </div>

    <script>
        const translations = {
            en: {
                modal: "For Sight Readers or New Players Only<br>Tap OK to Proceed",
                title: "GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)",
                subtitle: "Set the shutter top as the judgment line to disable delay.",
                bpm: "BPM:",
                hiSpeed: "HI-SPEED:",
                greenNumber: "Green Number:",
                whiteNumber: "White Number:",
                noteAdjust: "Note Display Adjustment:",
                judgeLine: "Judgment Line Position:",
                shutterIn: "SHUTTER (IN):",
                shutterOut: "SHUTTER (OUT):",
                refreshRate: "Refresh Rate (Hz):",
                monitorDelay: "Monitor Delay (ms):",
                notes: `
                    <p>Notes:</p>
                    <ul>
                        <li>Konaste's HI-SPEED adjustment is in 0.5 units.</li>
                        <li>The default monitor for GITADORA GALAXY WAVE DELTA is assumed to have a 9ms delay.</li>
                        <li>Sound depth balance varies by song; use headphones for zero audio delay.</li>
                        <li>HI-SPEED: x3.75 at BPM: 180 is the limit for stable note display.</li>
                    </ul>
                `
            },
            ja: {
                modal: "目押し勢または新規プレイヤーのみ<br>OKをタップして続行",
                title: "GITADORA GALAXY WAVE DELTA ドラムマニア設定ジェネレーター（非公式）",
                subtitle: "シャッター上部を判定ラインとして設定し、遅延を無効化します。",
                bpm: "BPM：",
                hiSpeed: "HI-SPEED：",
                greenNumber: "緑数字：",
                whiteNumber: "白数字：",
                noteAdjust: "ノーツ表示調整：",
                judgeLine: "判定ライン位置：",
                shutterIn: "SHUTTER (IN)：",
                shutterOut: "SHUTTER (OUT)：",
                refreshRate: "リフレッシュレート (Hz)：",
                monitorDelay: "モニター遅延 (ms)：",
                notes: `
                    <p>注意事項：</p>
                    <ul>
                        <li>コナステのHI-SPEED調整は0.5単位です。</li>
                        <li>GITADORA GALAXY WAVE DELTAの初期出荷モニターは遅延9msと仮定します。</li>
                        <li>曲によってスピーカーから出る音の奥行バランスが異なるため、ヘッドホンを装着して音声遅延無しを想定します。</li>
                        <li>HI-SPEED: x3.75 BPM: 180はノーツがぶれない限度です。</li>
                    </ul>
                `
            }
        };

        let currentLang = 'en';
        let history = [];

        // Load saved values or set defaults
        function loadSettings() {
            const saved = localStorage.getItem('settings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('bpm').value = settings.bpm || 180;
                document.getElementById('hi-speed').value = settings.hiSpeed || 3.75;
                document.getElementById('note-adjust').value = settings.noteAdjust || -6;
                document.getElementById('judge-line').value = settings.judgeLine || 8;
                document.getElementById('shutter-in').value = settings.shutterIn || 25;
            }
            updateCalculations();
        }

        // Save settings to localStorage
        function saveSettings() {
            const settings = {
                bpm: parseFloat(document.getElementById('bpm').value),
                hiSpeed: parseFloat(document.getElementById('hi-speed').value),
                noteAdjust: parseFloat(document.getElementById('note-adjust').value),
                judgeLine: parseFloat(document.getElementById('judge-line').value),
                shutterIn: parseFloat(document.getElementById('shutter-in').value)
            };
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        // Toggle language
        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ja' : 'en';
            document.getElementById('modal-text').innerHTML = translations[currentLang].modal;
            document.getElementById('title').innerText = translations[currentLang].title;
            document.getElementById('subtitle').innerText = translations[currentLang].subtitle;
            document.getElementById('bpm-label').innerText = translations[currentLang].bpm;
            document.getElementById('hi-speed-label').innerText = translations[currentLang].hiSpeed;
            document.getElementById('green-number-label').innerText = translations[currentLang].greenNumber;
            document.getElementById('white-number-label').innerText = translations[currentLang].whiteNumber;
            document.getElementById('note-adjust-label').innerText = translations[currentLang].noteAdjust;
            document.getElementById('judge-line-label').innerText = translations[currentLang].judgeLine;
            document.getElementById('shutter-in-label').innerText = translations[currentLang].shutterIn;
            document.getElementById('shutter-out-label').innerText = translations[currentLang].shutterOut;
            document.getElementById('refresh-rate-label').innerText = translations[currentLang].refreshRate;
            document.getElementById('monitor-delay-label').innerText = translations[currentLang].monitorDelay;
            document.getElementById('notes').innerHTML = translations[currentLang].notes;
        }

        // Close modal
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Spline interpolation for HI-SPEED
        function interpolateHiSpeed(bpm) {
            const points = [
                { bpm: 78, hiSpeed: 8.5 },
                { bpm: 180, hiSpeed: 3.75 },
                { bpm: 400, hiSpeed: 1.5 }
            ];
            if (bpm <= 78) return 8.5;
            if (bpm >= 400) return 1.5;
            for (let i = 1; i < points.length; i++) {
                if (bpm <= points[i].bpm) {
                    const t = (bpm - points[i-1].bpm) / (points[i].bpm - points[i-1].bpm);
                    return points[i-1].hiSpeed + t * (points[i].hiSpeed - points[i-1].hiSpeed);
                }
            }
        }

        // Calculate Green Number (simplified, based on IIDX logic)
        function calculateGreenNumber(bpm, hiSpeed) {
            // Placeholder: Green Number = 60000 / (BPM * HI-SPEED) * constant
            const constant = 0.016; // Tuned to match IIDX-like behavior
            return Math.round(60000 / (bpm * hiSpeed) * constant);
        }

        // Calculate White Number (placeholder)
        function calculateWhiteNumber(greenNumber) {
            // Placeholder: White Number is typically Green Number + offset
            return greenNumber + 100; // Simplified
        }

        // Update calculations
        function updateCalculations(source = '') {
            let bpm = parseFloat(document.getElementById('bpm').value) || 180;
            let hiSpeed = parseFloat(document.getElementById('hi-speed').value) || 3.75;
            let greenNumber = parseFloat(document.getElementById('green-number').value);

            if (source === 'bpm') {
                hiSpeed = interpolateHiSpeed(bpm);
                hiSpeed = Math.round(hiSpeed / 0.25) * 0.25;
                document.getElementById('hi-speed').value = hiSpeed.toFixed(2);
            } else if (source === 'hi-speed') {
                hiSpeed = Math.round(hiSpeed / 0.25) * 0.25;
                document.getElementById('hi-speed').value = hiSpeed.toFixed(2);
            } else if (source === 'green-number') {
                // Adjust HI-SPEED to maintain Green Number
                hiSpeed = 60000 / (bpm * greenNumber * 0.016);
                hiSpeed = Math.max(0.5, Math.min(10.0, Math.round(hiSpeed / 0.25) * 0.25));
                document.getElementById('hi-speed').value = hiSpeed.toFixed(2);
            }

            greenNumber = calculateGreenNumber(bpm, hiSpeed);
            document.getElementById('green-number').value = greenNumber;

            const whiteNumber = calculateWhiteNumber(greenNumber);
            document.getElementById('white-number').value = whiteNumber;

            // Note Display Adjustment (based on default -6 at BPM 180, HI-SPEED 3.75)
            const noteAdjust = Math.round(-6 * (180 * 3.75) / (bpm * hiSpeed));
            document.getElementById('note-adjust').value = Math.max(-20, Math.min(20, noteAdjust));

            // Judgment Line Position and SHUTTER (IN) (placeholder logic)
            const judgeLine = Math.round(8 * (180 * 3.75) / (bpm * hiSpeed));
            document.getElementById('judge-line').value = Math.max(0, Math.min(20, judgeLine));

            const shutterIn = Math.round(25 * (180 * 3.75) / (bpm * hiSpeed));
            document.getElementById('shutter-in').value = Math.max(0, Math.min(30, shutterIn));

            saveSettings();
            logChange(source);
        }

        // Log changes
        function logChange(source) {
            if (!source) return;
            const timestamp = new Date().toLocaleString();
            const values = {
                bpm: document.getElementById('bpm').value,
                hiSpeed: document.getElementById('hi-speed').value,
                greenNumber: document.getElementById('green-number').value
            };
            const entry = `[${timestamp}] ${source}: ${values[source]}`;
            history.unshift(entry);
            if (history.length > 10) history.pop();
            document.getElementById('history').innerHTML = `<p>Change History:</p>${history.map(h => `<p>${h}</p>`).join('')}`;
        }

        // Event listeners
        document.getElementById('bpm').addEventListener('input', () => updateCalculations('bpm'));
        document.getElementById('hi-speed').addEventListener('input', () => updateCalculations('hi-speed'));
        document.getElementById('green-number').addEventListener('input', () => updateCalculations('green-number'));

        // Initialize
        loadSettings();
        toggleLanguage();
    </script>
</body>
</html>
