<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
      max-width: 600px;
      margin: 0 auto;
    }
    h1, h2 { text-align: center; }
    .lang-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1000;
    }
    .input-group {
      margin: 10px 0;
      display: flex;
      align-items: center;
    }
    .input-group label {
      flex: 1;
      font-weight: bold;
    }
    .input-group input {
      flex: 1;
      padding: 5px;
      font-size: 16px;
    }
    .input-group input:disabled {
      background-color: #e0e0e0;
      cursor: not-allowed;
    }
    .input-group button {
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .notes { font-size: 14px; color: #555; }
    .log { margin-top: 20px; font-size: 14px; }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      text-align: center;
      max-width: 80%;
    }
    .modal-content button {
      margin-top: 10px;
      padding: 10px 20px;
      cursor: pointer;
    }
    @media (max-width: 400px) {
      body { padding: 10px; }
      h1 { font-size: 20px; }
      h2 { font-size: 16px; }
      .input-group input, .input-group button { font-size: 14px; }
    }
  </style>
</head>
<body>
  <button class="lang-toggle" onclick="toggleLanguage()">日本語</button>
  <h1 data-en="GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)" 
      data-jp="GITADORA GALAXY WAVE DELTA ドラムマニア設定ジェネレーター（非公式）">
    GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)
  </h1>
  <h2 data-en="Set the shutter top as the judgment line to disable delay." 
      data-jp="シャッター上部を判定ラインとして設定し、遅延を無効化します。">
    Set the shutter top as the judgment line to disable delay.
  </h2>

  <div class="input-group">
    <label data-en="BPM" data-jp="BPM">BPM</label>
    <button onclick="adjustValue('bpm', -1)">▼</button>
    <input type="number" id="bpm" value="180" min="78" max="400" step="1" oninput="updateSettings('bpm')">
    <button onclick="adjustValue('bpm', 1)">▲</button>
  </div>
  <div class="input-group">
    <label data-en="HI-SPEED" data-jp="HI-SPEED">HI-SPEED</label>
    <button onclick="adjustValue('hiSpeed', -0.25)">▼</button>
    <input type="number" id="hiSpeed" value="3.75" min="0.5" max="10" step="0.25" oninput="updateSettings('hiSpeed')">
    <button onclick="adjustValue('hiSpeed', 0.25)">▲</button>
  </div>
  <div class="input-group">
    <label data-en="Green Number (ms)" data-jp="緑数字 (ms)">Green Number (ms)</label>
    <button onclick="adjustValue('greenNumber', -1)">▼</button>
    <input type="number" id="greenNumber" value="88.89" step="0.01" oninput="updateSettings('greenNumber')">
    <button onclick="adjustValue('greenNumber', 1)">▲</button>
  </div>
  <div class="input-group">
    <label data-en="Note Display Adjustment" data-jp="ノーツ表示調整">Note Display Adjustment</label>
    <input type="number" id="noteAdjust" value="-6" disabled>
  </div>
  <div class="input-group">
    <label data-en="Judgment Line Position" data-jp="判定ライン位置">Judgment Line Position</label>
    <input type="number" id="judgeLine" value="8" disabled>
  </div>
  <div class="input-group">
    <label data-en="SHUTTER (IN)" data-jp="SHUTTER (IN)">SHUTTER (IN)</label>
    <input type="number" id="shutterIn" value="25" disabled>
  </div>
  <div class="input-group">
    <label data-en="SHUTTER (OUT)" data-jp="SHUTTER (OUT)">SHUTTER (OUT)</label>
    <input type="number" id="shutterOut" value="16" disabled>
  </div>
  <div class="input-group">
    <label data-en="Refresh Rate (Hz)" data-jp="リフレッシュレート (Hz)">Refresh Rate (Hz)</label>
    <input type="number" id="refreshRate" value="60" disabled>
  </div>
  <div class="input-group">
    <label data-en="Monitor Delay (ms)" data-jp="モニター遅延 (ms)">Monitor Delay (ms)</label>
    <input type="number" id="monitorDelay" value="9" disabled>
  </div>

  <div class="notes">
    <p data-en="Notes:" data-jp="注意事項：">Notes:</p>
    <ul>
      <li data-en="Konaste HI-SPEED adjustment is in 0.5 units." 
          data-jp="コナステのHI-SPEED調整は0.5単位です。">
        Konaste HI-SPEED adjustment is in 0.5 units.
      </li>
      <li data-en="Assumes GITADORA GALAXY WAVE DELTA initial monitor delay is 9ms." 
          data-jp="GITADORA GALAXY WAVE DELTAの初期出荷モニターは遅延9msと仮定。">
        Assumes GITADORA GALAXY WAVE DELTA initial monitor delay is 9ms.
      </li>
      <li data-en="Due to varying sound depth balance per song, assume headphones with no audio delay." 
          data-jp="各スピーカーから出る音の奥行バランスが曲によって異なるため、ヘッドホンを装着して音声遅延無しを想定。">
        Due to varying sound depth balance per song, assume headphones with no audio delay.
      </li>
      <li data-en="HI-SPEED: x3.75 at BPM: 180 is the limit for stable note display." 
          data-jp="HI-SPEED: x3.75 BPM: 180はノーツがぶれない限度です。">
        HI-SPEED: x3.75 at BPM: 180 is the limit for stable note display.
      </li>
    </ul>
  </div>

  <div class="log" id="changeLog">
    <p data-en="Change Log:" data-jp="変更ログ：">Change Log:</p>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <p data-en="For sight-readers or new players only.<br>Tap OK to continue." 
          data-jp="目押し勢 or 新規プレイヤー<br>どちらかに該当する方のみ<br>OKボタンをタップ">
        For sight-readers or new players only.<br>Tap OK to continue.
      </p>
      <button onclick="closeModal()">OK</button>
    </div>
  </div>

  <script>
    // Language handling
    let currentLang = 'en';
    function toggleLanguage() {
      currentLang = currentLang === 'en' ? 'jp' : 'en';
      document.querySelector('.lang-toggle').textContent = currentLang === 'en' ? '日本語' : 'English';
      document.querySelectorAll('[data-en]').forEach(el => {
        el.innerHTML = el.getAttribute(`data-${currentLang}`);
      });
    }

    // Modal handling
    function showModal() {
      document.getElementById('modal').style.display = 'flex';
      document.body.style.pointerEvents = 'none';
      document.getElementById('modal').style.pointerEvents = 'auto';
    }
    function closeModal() {
      document.getElementById('modal').style.display = 'none';
      document.body.style.pointerEvents = 'auto';
    }

    // Local storage
    function loadSettings() {
      const settings = JSON.parse(localStorage.getItem('gitadoraSettings')) || {
        bpm: 180,
        hiSpeed: 3.75,
        greenNumber: 88.89,
        noteAdjust: -6,
        judgeLine: 8,
        shutterIn: 25
      };
      document.getElementById('bpm').value = settings.bpm;
      document.getElementById('hiSpeed').value = settings.hiSpeed;
      document.getElementById('greenNumber').value = settings.greenNumber.toFixed(2);
      document.getElementById('noteAdjust').value = settings.noteAdjust;
      document.getElementById('judgeLine').value = settings.judgeLine;
      document.getElementById('shutterIn').value = settings.shutterIn;
    }
    function saveSettings() {
      const settings = {
        bpm: parseFloat(document.getElementById('bpm').value) || 180,
        hiSpeed: parseFloat(document.getElementById('hiSpeed').value) || 3.75,
        greenNumber: parseFloat(document.getElementById('greenNumber').value) || 88.89,
        noteAdjust: parseInt(document.getElementById('noteAdjust').value) || -6,
        judgeLine: parseInt(document.getElementById('judgeLine').value) || 8,
        shutterIn: parseInt(document.getElementById('shutterIn').value) || 25
      };
      localStorage.setItem('gitadoraSettings', JSON.stringify(settings));
    }

    // Change log
    function logChange(field, value) {
      const timestamp = new Date().toLocaleString();
      const logEntry = document.createElement('p');
      logEntry.textContent = `[${timestamp}] ${field}: ${value}`;
      document.getElementById('changeLog').appendChild(logEntry);
      document.getElementById('changeLog').scrollTop = document.getElementById('changeLog').scrollHeight;
    }

    // Spline interpolation for HI-SPEED limits
    function interpolateHiSpeed(bpm) {
      const points = [
        { bpm: 78, hiSpeed: 8.5 },
        { bpm: 180, hiSpeed: 3.75 },
        { bpm: 400, hiSpeed: 1.5 }
      ];
      if (bpm <= 78) return 8.5;
      if (bpm >= 400) return 1.5;
      // Linear interpolation for simplicity (spline can be complex)
      for (let i = 0; i < points.length - 1; i++) {
        if (bpm >= points[i].bpm && bpm <= points[i + 1].bpm) {
          const t = (bpm - points[i].bpm) / (points[i + 1].bpm - points[i].bpm);
          return points[i].hiSpeed + t * (points[i + 1].hiSpeed - points[i].hiSpeed);
        }
      }
      return 3.75; // Fallback
    }

    // Update settings based on input
    function updateSettings(source) {
      let bpm = parseFloat(document.getElementById('bpm').value) || 180;
      let hiSpeed = parseFloat(document.getElementById('hiSpeed').value) || 3.75;
      let greenNumber = parseFloat(document.getElementById('greenNumber').value) || 88.89;

      // Enforce constraints
      bpm = Math.min(Math.max(bpm, 78), 400);
      hiSpeed = Math.min(Math.max(hiSpeed, 0.5), 10);
      hiSpeed = Math.round(hiSpeed * 4) / 4; // Snap to 0.25 increments

      if (source === 'bpm') {
        logChange('BPM', bpm);
        // Maintain green number, adjust HI-SPEED and others
        hiSpeed = interpolateHiSpeed(bpm);
        greenNumber = (60000 / bpm) / hiSpeed;
      } else if (source === 'hiSpeed') {
        logChange('HI-SPEED', hiSpeed);
        // Maintain BPM, adjust green number and others
        greenNumber = (60000 / bpm) / hiSpeed;
      } else if (source === 'greenNumber') {
        logChange('Green Number', greenNumber.toFixed(2));
        // Maintain BPM, adjust HI-SPEED and others
        hiSpeed = (60000 / bpm) / greenNumber;
        hiSpeed = Math.min(Math.max(hiSpeed, 0.5), 10);
        hiSpeed = Math.round(hiSpeed * 4) / 4;
      }

      // Calculate derived values
      const noteAdjust = Math.round(-6 * (hiSpeed / 3.75) * (180 / bpm)); // Scale based on default
      const judgeLine = Math.round(8 * (hiSpeed / 3.75) * (180 / bpm));
      const shutterIn = Math.round(25 * (hiSpeed / 3.75) * (180 / bpm));

      // Update inputs
      document.getElementById('bpm').value = bpm;
      document.getElementById('hiSpeed').value = hiSpeed.toFixed(2);
      document.getElementById('greenNumber').value = greenNumber.toFixed(2);
      document.getElementById('noteAdjust').value = Math.min(Math.max(noteAdjust, -20), 20);
      document.getElementById('judgeLine').value = judgeLine;
      document.getElementById('shutterIn').value = shutterIn;

      saveSettings();
    }

    // Adjust values with buttons
    function adjustValue(field, delta) {
      const input = document.getElementById(field);
      let value = parseFloat(input.value) || 0;
      value += delta;
      if (field === 'hiSpeed') {
        value = Math.round(value * 4) / 4; // Snap to 0.25
        value = Math.min(Math.max(value, 0.5), 10);
      } else if (field === 'bpm') {
        value = Math.min(Math.max(value, 78), 400);
      }
      input.value = field === 'hiSpeed' ? value.toFixed(2) : Math.round(value);
      updateSettings(field);
    }

    // Initialize
    window.onload = () => {
      loadSettings();
      updateSettings('bpm'); // Initial calculation
      showModal();
    };
  </script>
</body>
</html>
