<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</title>
    <style>
        /* Minimal inline CSS for iPhone Safari 9:16 layout, as external CSS is not allowed */
        body {
            font-family: -apple-system, sans-serif;
            margin: 0;
            padding: 10px;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            font-size: 16px;
        }
        .container {
            width: 100%;
            max-width: 360px;
            text-align: center;
        }
        h1 {
            font-size: 1.5em;
            margin: 10px 0;
        }
        h2 {
            font-size: 1.2em;
            color: #555;
            margin: 5px 0;
        }
        .lang-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 80%;
        }
        .modal-content p {
            white-space: pre-line;
            margin-bottom: 20px;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        label {
            font-weight: bold;
            display: block;
            text-align: left;
        }
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 8px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        input[readonly] {
            background: #e0e0e0;
            color: #666;
        }
        .button-group {
            display: flex;
            gap: 5px;
        }
        input[type="submit"], input[type="button"] {
            padding: 8px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            background: #007aff;
            color: white;
            cursor: pointer;
        }
        .warning {
            color: red;
            font-size: 0.9em;
        }
        .notes {
            font-size: 0.9em;
            color: #333;
            text-align: left;
            margin-top: 20px;
        }
        .notes p {
            white-space: pre-line;
        }
        .history {
            margin-top: 20px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.9em;
            text-align: left;
        }
        @media (max-width: 360px) {
            body { font-size: 14px; }
            h1 { font-size: 1.3em; }
            h2 { font-size: 1em; }
        }
    </style>
</head>
<body onload="document.getElementById('modal').style.display='flex'; loadSettings();">
    <!-- Modal for initial warning -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <p id="modal-text">Visual timing players or new players
Only those applicable
Tap the OK button</p>
            <input type="button" value="OK" onclick="document.getElementById('modal').style.display='none';">
        </div>
    </div>

    <!-- Language Toggle -->
    <div class="lang-toggle">
        <input type="button" value="日本語" onclick="toggleLanguage('ja');">
        <input type="button" value="English" onclick="toggleLanguage('en');">
    </div>

    <!-- Main Content -->
    <div class="container">
        <h1 id="title">GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</h1>
        <h2 id="subtitle">Set the shutter top as the judgment line to disable delay.</h2>

        <!-- Settings Form -->
        <form id="settings-form" onsubmit="calculateSettings(); return false;">
            <label for="bpm">BPM:</label>
            <div class="button-group">
                <input type="button" value="-" onclick="adjustValue('bpm', -1);">
                <input type="number" id="bpm" name="bpm" value="180" min="1" step="1" oninput="calculateSettings();">
                <input type="button" value="+" onclick="adjustValue('bpm', 1);">
            </div>

            <label for="hi-speed">HI-SPEED:</label>
            <div class="button-group">
                <input type="button" value="-" onclick="adjustHiSpeed(-0.25);">
                <input type="number" id="hi-speed" name="hi-speed" value="3.75" min="0.5" max="10" step="0.25" oninput="calculateSettings();">
                <input type="button" value="+" onclick="adjustHiSpeed(0.25);">
            </div>

            <label for="green-number">Green Number (IIDX-like):</label>
            <input type="number" id="green-number" name="green-number" value="300" oninput="calculateFromGreen();">

            <label for="white-number">White Number (IIDX-like):</label>
            <input type="text" id="white-number" name="white-number" value="600" readonly>

            <label for="note-adjust">Note Display Adjust:</label>
            <input type="text" id="note-adjust" name="note-adjust" value="-6" readonly>

            <label for="judge-line">Judgment Line Position:</label>
            <input type="text" id="judge-line" name="judge-line" value="8" readonly>

            <label for="shutter-in">SHUTTER (IN):</label>
            <input type="text" id="shutter-in" name="shutter-in" value="25" readonly>

            <label for="shutter-out">SHUTTER (OUT):</label>
            <input type="text" id="shutter-out" name="shutter-out" value="16" readonly>

            <label for="refresh-rate">Refresh Rate (Hz):</label>
            <input type="text" id="refresh-rate" name="refresh-rate" value="60" readonly>

            <label for="monitor-delay">Monitor Delay (ms):</label>
            <input type="text" id="monitor-delay" name="monitor-delay" value="9" readonly>

            <p id="warning" class="warning"></p>
            <input type="submit" value="Apply">
        </form>

        <!-- Explanation -->
        <div class="notes">
            <h3 id="explanation-title">Explanation</h3>
            <p id="explanation-text">This tool adjusts settings to align the SHUTTER (OUT) top edge with the judgment line, ensuring stable note timing at 60Hz. HI-SPEED limits are interpolated (BPM 78: x8.5, BPM 180: x3.75, BPM 400: x1.5). Green number mimics IIDX timing window; adjusting it recalculates HI-SPEED, Note Adjust, Judgment Line, and SHUTTER (IN). BPM changes maintain green number. Monitor delay (9ms) is compensated for visual timing play.</p>
        </div>

        <!-- Notes -->
        <div class="notes">
            <h3 id="notes-title">Notes</h3>
            <p id="notes-text">※ Konaste HI-SPEED adjusts in 0.5 units
※ GITADORA GALAXY WAVE DELTA's default monitor assumes 9ms delay
※ Sound depth varies by song; use headphones for zero audio delay
※ HI-SPEED x3.75 at BPM 180 is the stable note limit</p>
        </div>

        <!-- Change History -->
        <div class="history">
            <h3 id="history-title">Change History</h3>
            <div id="history-log"></div>
        </div>
    </div>

    <script>
        // JavaScript for functionality (used minimally to meet requirements)
        let lang = 'en';

        function toggleLanguage(newLang) {
            lang = newLang;
            const texts = {
                en: {
                    modal: "Visual timing players or new players\nOnly those applicable\nTap the OK button",
                    title: "GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)",
                    subtitle: "Set the shutter top as the judgment line to disable delay.",
                    explanation: "This tool adjusts settings to align the SHUTTER (OUT) top edge with the judgment line, ensuring stable note timing at 60Hz. HI-SPEED limits are interpolated (BPM 78: x8.5, BPM 180: x3.75, BPM 400: x1.5). Green number mimics IIDX timing window; adjusting it recalculates HI-SPEED, Note Adjust, Judgment Line, and SHUTTER (IN). BPM changes maintain green number. Monitor delay (9ms) is compensated for visual timing play.",
                    notes: "※ Konaste HI-SPEED adjusts in 0.5 units\n※ GITADORA GALAXY WAVE DELTA's default monitor assumes 9ms delay\n※ Sound depth varies by song; use headphones for zero audio delay\n※ HI-SPEED x3.75 at BPM 180 is the stable note limit",
                    explanationTitle: "Explanation",
                    notesTitle: "Notes",
                    historyTitle: "Change History"
                },
                ja: {
                    modal: "目押し勢 or 新規プレイヤー\nどちらかに該当する方のみ\nOKボタンをタップ",
                    title: "GITADORA GALAXY WAVE DELTA Drummania セッティングジェネレーター（非公式）",
                    subtitle: "シャッター上部を判定ラインとして遅延を無効化。",
                    explanation: "このツールは、SHUTTER (OUT)の上部を判定ラインに合わせて設定し、60Hzで安定したノーツタイミングを確保します。HI-SPEEDの上限は補間されます（BPM 78: x8.5、BPM 180: x3.75、BPM 400: x1.5）。緑数字はIIDXのタイミングウィンドウを模倣し、調整するとHI-SPEED、ノーツ表示調整、判定ライン位置、SHUTTER (IN)が再計算されます。BPM変更は緑数字を維持。モニター遅延（9ms）は視覚タイミングプレイ用に補償されます。",
                    notes: "※ コナステのHI-SPEED調整は0.5単位\n※ GITADORA GALAXY WAVE DELTAの初期出荷モニターは遅延9msと仮定\n※ 各スピーカーから出る音の奥行バランスが曲によって異なるため、ヘッドホンを装着して音声遅延無しを想定\n※ HI-SPEED x3.75 BPM 180はノーツがぶれない限度です",
                    explanationTitle: "説明",
                    notesTitle: "注意書き",
                    historyTitle: "変更履歴"
                }
            };
            document.getElementById('modal-text').innerText = texts[lang].modal;
            document.getElementById('title').innerText = texts[lang].title;
            document.getElementById('subtitle').innerText = texts[lang].subtitle;
            document.getElementById('explanation-title').innerText = texts[lang].explanationTitle;
            document.getElementById('explanation-text').innerText = texts[lang].explanation;
            document.getElementById('notes-title').innerText = texts[lang].notesTitle;
            document.getElementById('notes-text').innerText = texts[lang].notes;
            document.getElementById('history-title').innerText = texts[lang].historyTitle;
        }

        function loadSettings() {
            // Load from localStorage
            const saved = JSON.parse(localStorage.getItem('gitadoraSettings')) || {};
            document.getElementById('bpm').value = saved.bpm || 180;
            document.getElementById('hi-speed').value = saved.hiSpeed || 3.75;
            document.getElementById('green-number').value = saved.greenNumber || 300;
            calculateSettings();
        }

        function saveSettings() {
            const settings = {
                bpm: parseFloat(document.getElementById('bpm').value),
                hiSpeed: parseFloat(document.getElementById('hi-speed').value),
                greenNumber: parseFloat(document.getElementById('green-number').value)
            };
            localStorage.setItem('gitadoraSettings', JSON.stringify(settings));
            logChange(settings);
        }

        function adjustValue(fieldId, delta) {
            const input = document.getElementById(fieldId);
            let value = parseFloat(input.value) + delta;
            if (fieldId === 'bpm' && value < 1) value = 1;
            input.value = value;
            calculateSettings();
        }

        function adjustHiSpeed(delta) {
            const input = document.getElementById('hi-speed');
            let value = parseFloat(input.value) + delta;
            value = Math.round(value * 100) / 100; // Ensure 0.25 steps
            if (value < 0.5) value = 0.5;
            if (value > 10) value = 10;
            input.value = value;
            calculateSettings();
        }

        function calculateSettings() {
            const bpm = parseFloat(document.getElementById('bpm').value) || 180;
            let hiSpeed = parseFloat(document.getElementById('hi-speed').value) || 3.75;
            const greenNumberInput = parseFloat(document.getElementById('green-number').value);

            // Spline interpolation for HI-SPEED limits (approximated)
            const bpmPoints = [78, 180, 400];
            const hiSpeedPoints = [8.5, 3.75, 1.5];
            let hiSpeedLimit;
            if (bpm <= 78) hiSpeedLimit = 8.5;
            else if (bpm >= 400) hiSpeedLimit = 1.5;
            else if (bpm <= 180) {
                // Linear interpolation between 78 and 180
                hiSpeedLimit = 8.5 + (3.75 - 8.5) * (bpm - 78) / (180 - 78);
            } else {
                // Linear interpolation between 180 and 400
                hiSpeedLimit = 3.75 + (1.5 - 3.75) * (bpm - 180) / (400 - 180);
            }

            // Check if HI-SPEED exceeds limit
            const warning = document.getElementById('warning');
            if (hiSpeed > hiSpeedLimit) {
                warning.innerText = lang === 'en' ? 'Adjustment required' : '要調整';
            } else {
                warning.innerText = '';
            }

            // Green number calculation (approximated IIDX-like timing window)
            // Green number = (60 / BPM) * (1000 / HI-SPEED) * scaling_factor
            const scalingFactor = 8000; // Adjusted to match IIDX-like values
            let greenNumber = (60 / bpm) * (1000 / hiSpeed) * scalingFactor;
            greenNumber = Math.round(greenNumber);

            // If green number was edited, adjust HI-SPEED
            if (greenNumberInput && greenNumberInput !== greenNumber) {
                hiSpeed = (60 / bpm) * (1000 / (greenNumberInput / scalingFactor));
                hiSpeed = Math.round(hiSpeed * 100) / 100;
                if (hiSpeed < 0.5) hiSpeed = 0.5;
                if (hiSpeed > 10) hiSpeed = 10;
                document.getElementById('hi-speed').value = hiSpeed;
            } else {
                document.getElementById('green-number').value = greenNumber;
            }

            // White number (approximated, typically double green number)
            const whiteNumber = greenNumber * 2;
            document.getElementById('white-number').value = whiteNumber;

            // Note Display Adjust (based on monitor delay and green number)
            let noteAdjust = -6; // Default for BPM 180, HI-SPEED 3.75
            noteAdjust = Math.round(-6 * (180 / bpm) * (hiSpeed / 3.75));
            if (noteAdjust < -20) noteAdjust = -20;
            if (noteAdjust > 20) noteAdjust = 20;
            document.getElementById('note-adjust').value = noteAdjust;

            // Judgment Line Position (fixed relative to SHUTTER OUT)
            const judgeLine = 8; // Default, assumed constant
            document.getElementById('judge-line').value = judgeLine;

            // SHUTTER (IN) adjustment
            let shutterIn = 25; // Default
            shutterIn = Math.round(25 * (hiSpeed / 3.75));
            if (shutterIn < 0) shutterIn = 0;
            if (shutterIn > 30) shutterIn = 30;
            document.getElementById('shutter-in').value = shutterIn;

            saveSettings();
        }

        function calculateFromGreen() {
            // Recalculate based on green number
            calculateSettings();
        }

        function logChange(settings) {
            const log = document.getElementById('history-log');
            const timestamp = new Date().toLocaleString();
            const entry = `[${timestamp}] BPM: ${settings.bpm}, HI-SPEED: x${settings.hiSpeed}, Green: ${settings.greenNumber}\n`;
            log.innerText = entry + log.innerText;
        }
    </script>
</body>
</html>
