<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #f0f0f0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .container { width: 90%; max-width: 360px; padding: 10px; aspect-ratio: 9/16; }
        h1 { font-size: 20px; text-align: center; margin: 10px 0; }
        h2 { font-size: 16px; text-align: center; margin: 5px 0; color: #555; }
        .lang-toggle { position: absolute; top: 10px; right: 10px; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 20px; border-radius: 10px; text-align: center; max-width: 80%; }
        .modal-content p { font-weight: bold; }
        .field { margin: 10px 0; display: flex; align-items: center; justify-content: space-between; }
        .field label { font-size: 14px; width: 40%; }
        .field input, .field button { font-size: 14px; padding: 5px; }
        .field input[disabled] { background: #e0e0e0; }
        .field button { width: 30px; }
        .warning { font-size: 12px; color: red; margin: 5px 0; }
        .note { font-size: 12px; margin: 10px 0; }
        .history { border: 1px solid #ccc; padding: 10px; margin-top: 20px; font-size: 12px; max-height: 100px; overflow-y: auto; }
    </style>
</head>
<body>
    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <p id="modal-text">Only for players who rely on visual timing or new players.<br>Please tap OK.</p>
            <form action="" method="POST">
                <input type="hidden" name="modal_dismiss" value="1">
                <button type="submit">OK</button>
            </form>
        </div>
    </div>

    <div class="container">
        <!-- Language Toggle -->
        <div class="lang-toggle">
            <form action="" method="POST">
                <input type="hidden" name="lang" value="jp">
                <button type="submit">日本語</button>
            </form>
        </div>

        <!-- Titles -->
        <h1 id="title">GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</h1>
        <h2 id="subtitle">Set the shutter top as the judgment line to disable delay.</h2>

        <!-- Settings Form -->
        <form action="" method="POST">
            <!-- BPM -->
            <div class="field">
                <label for="bpm">BPM:</label>
                <button type="submit" name="bpm_dec">-</button>
                <input type="number" id="bpm" name="bpm" value="180" min="1" step="1" required>
                <button type="submit" name="bpm_inc">+</button>
            </div>

            <!-- HI-SPEED -->
            <div class="field">
                <label for="hi_speed">HI-SPEED:</label>
                <button type="submit" name="hi_speed_dec">-</button>
                <input type="number" id="hi_speed" name="hi_speed" value="3.75" min="0.5" max="10.0" step="0.25" required>
                <button type="submit" name="hi_speed_inc">+</button>
            </div>

            <!-- Green Number -->
            <div class="field">
                <label for="green_number">Green Number:</label>
                <input type="number" id="green_number" name="green_number" value="225" required>
            </div>

            <!-- Non-editable Fields -->
            <div class="field">
                <label for="note_adjust">Note Display Adjust:</label>
                <input type="number" id="note_adjust" name="note_adjust" value="-6" disabled>
            </div>
            <div class="field">
                <label for="judge_line">Judgment Line Position:</label>
                <input type="number" id="judge_line" name="judge_line" value="8" disabled>
            </div>
            <div class="field">
                <label for="shutter_in">SHUTTER (IN):</label>
                <input type="number" id="shutter_in" name="shutter_in" value="25" disabled>
            </div>
            <div class="field">
                <label for="shutter_out">SHUTTER (OUT):</label>
                <input type="number" id="shutter_out" name="shutter_out" value="16" disabled>
            </div>
            <div class="field">
                <label for="refresh_rate">Refresh Rate (Hz):</label>
                <input type="number" id="refresh_rate" name="refresh_rate" value="60" disabled>
            </div>
            <div class="field">
                <label for="monitor_delay">Monitor Delay (ms):</label>
                <input type="number" id="monitor_delay" name="monitor_delay" value="9" disabled>
            </div>
            <div class="field">
                <label for="white_number">White Number:</label>
                <input type="number" id="white_number" name="white_number" value="150" disabled>
            </div>

            <!-- Warning for HI-SPEED -->
            <div class="warning" id="hi_speed_warning"></div>
        </form>

        <!-- Explanation -->
        <div class="note" id="explanation">
            <p>This tool calculates settings to fix the judgment line at SHUTTER (OUT)'s top, ensuring stable note display at 60Hz. BPM, HI-SPEED, and Green Number adjustments recalculate Note Display Adjust, Judgment Line Position, and SHUTTER (IN). HI-SPEED is interpolated (BPM 78: x8.5, 180: x3.75, 400: x1.5).</p>
        </div>

        <!-- Warnings -->
        <div class="note" id="warnings">
            <p>※ KONASTE HI-SPEED adjusts in 0.5 units.<br>
            ※ Assumes 9ms monitor delay for GITADORA GALAXY WAVE DELTA's default monitor.<br>
            ※ Sound depth varies by song; use headphones for zero audio delay.<br>
            ※ HI-SPEED x3.75 at BPM 180 is the limit for stable notes.</p>
        </div>

        <!-- History Log -->
        <div class="history" id="history">
            <p>[2025-04-21 19:44 JST] BPM: 180, HI-SPEED: x3.75, Green Number: 225</p>
        </div>
    </div>

    <!-- Japanese Language Form (Hidden, for Toggle) -->
    <form id="lang_jp_form" action="" method="POST" style="display: none;">
        <input type="hidden" name="lang" value="en">
        <input type="submit" value="English">
    </form>

    <!-- Server-side Logic Placeholder -->
    <!--
        Server-side (e.g., PHP) would handle:
        - Modal dismissal: Hide modal if $_POST['modal_dismiss'] == 1
        - Language toggle: Switch text based on $_POST['lang'] ('en' or 'jp')
        - Calculations:
            - HI-SPEED bounds: Linear interpolation between (78, 8.5), (180, 3.75), (400, 1.5)
            - Green Number: (60000 / BPM) * (4 / HI-SPEED) - 9
            - Note Display Adjust: -6 * (180 / BPM) * (HI-SPEED / 3.75), clamped -20 to +20
            - Judgment Line Position: 8 + (BPM - 180) * 0.02, clamped 0 to 20
            - SHUTTER (IN): 25 - (HI-SPEED - 3.75) * 2, clamped 0 to 30
        - Local storage: Save $_POST values to session or database
        - History: Append timestamp and changed values
    -->
</body>
</html>
