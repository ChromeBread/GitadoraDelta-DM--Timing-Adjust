<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</title>
</head>
<body onload="loadSettings(); showModal();" style="font-family: Arial, sans-serif; margin: 0; padding: 10px; max-width: 100%; box-sizing: border-box;">
    <!-- Modal -->
    <div id="modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
            <p><b>目押し勢 or 新規プレイヤー<br>どちらかに該当する方のみ<br>OKボタンをタップ</b><br><br><b>Visual Timing Players or New Players<br>Only those who fall into either category<br>Tap the OK button</b></p>
            <button onclick="document.getElementById('modal').style.display='none';">OK</button>
        </div>
    </div>

    <!-- Language Toggle -->
    <div style="position: fixed; top: 10px; right: 10px; z-index: 999;">
        <button onclick="toggleLanguage()">English / 日本語</button>
    </div>

    <!-- Main Content -->
    <div id="content-en" style="display: block;">
        <h1 style="font-size: 1.5em;">GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</h1>
        <h2 style="font-size: 1.2em;">Set the shutter top as the judgment line to disable delay.</h2>
        <p><b>Notes:</b><br>
        - Konaste's HI-SPEED adjustment is in 0.5 increments.<br>
        - GITADORA GALAXY WAVE DELTA's default monitor is assumed to have a 9ms delay.<br>
        - Sound depth balance varies by song; assume headphones with no audio delay.<br>
        - HI-SPEED: x3.75 at BPM: 180 is the limit for stable note display.<br>
        - SHUTTER (OUT) is fixed at 16.</p>
    </div>
    <div id="content-jp" style="display: none;">
        <h1 style="font-size: 1.5em;">GITADORA GALAXY WAVE DELTA ドラムマニア設定ジェネレーター（非公式）</h1>
        <h2 style="font-size: 1.2em;">シャッター上部を判定ラインとして固定し、遅延を無効化する。</h2>
        <p><b>注意:</b><br>
        - コナステのHI-SPEED調整は0.5単位です。<br>
        - GITADORA GALAXY WAVE DELTAの初期出荷モニターは遅延9msと仮定。<br>
        - 各スピーカーから出る音の奥行バランスが曲によって異なるため、ヘッドホンを装着して音声遅延無しを想定。<br>
        - HI-SPEED: x3.75 BPM: 180はノーツがぶれない限度です。<br>
        - SHUTTER (OUT)は16で固定。</p>
    </div>

    <!-- Settings Form -->
    <form id="settings-form" oninput="calculateSettings(); saveSettings();">
        <div>
            <label id="label-bpm">BPM:</label><br>
            <input type="number" id="bpm" min="78" max="400" step="1" value="180" onchange="logChange('BPM', this.value);" required>
            <input type="button" value="▲" onclick="adjustValue('bpm', 1);">
            <input type="button" value="▼" onclick="adjustValue('bpm', -1);">
        </div>
        <div>
            <label id="label-hi-speed">HI-SPEED:</label><br>
            <input type="number" id="hi-speed" min="0.5" max="10.0" step="0.01" value="3.75" onchange="logChange('HI-SPEED', this.value); adjustHiSpeed();" required>
            <input type="button" value="▲" onclick="adjustHiSpeedValue(0.25);">
            <input type="button" value="▼" onclick="adjustHiSpeedValue(-0.25);">
        </div>
        <div>
            <label id="label-green">Green Number (IIDX equivalent):</label><br>
            <input type="number" id="green-number" min="0" step="0.1" value="320" onchange="logChange('Green Number', this.value);" required>
            <input type="button" value="▲" onclick="adjustValue('green-number', 0.1);">
            <input type="button" value="▼" onclick="adjustValue('green-number', -0.1);">
        </div>
        <div>
            <label id="label-note-adjust">Note Display Adjustment:</label><br>
            <input type="number" id="note-adjust" min="-20" max="20" step="1" value="-6" readonly style="background: #ccc;">
        </div>
        <div>
            <label id="label-judge-line">Judgment Line Position:</label><br>
            <input type="number" id="judge-line" min="0" max="20" step="1" value="8" readonly style="background: #ccc;">
        </div>
        <div>
            <label id="label-shutter-in">SHUTTER (IN):</label><br>
            <input type="number" id="shutter-in" min="0" max="30" step="1" value="25" readonly style="background: #ccc;">
        </div>
        <div>
            <label id="label-shutter-out">SHUTTER (OUT):</label><br>
            <input type="number" id="shutter-out" value="16" readonly style="background: #ccc;">
        </div>
        <div>
            <label id="label-refresh-rate">Refresh Rate (Hz):</label><br>
            <input type="number" id="refresh-rate" value="60" readonly style="background: #ccc;">
        </div>
        <div>
            <label id="label-monitor-delay">Monitor Delay (ms):</label><br>
            <input type="number" id="monitor-delay" value="9" readonly style="background: #ccc;">
        </div>
        <div>
            <label id="label-white">White Number (IIDX equivalent):</label><br>
            <input type="number" id="white-number" value="0" readonly style="background: #ccc;">
        </div>
    </form>

    <!-- Change Log -->
    <div>
        <h3 id="log-title">Change Log</h3>
        <div id="change-log" style="border: 1px solid #000; padding: 10px; max-height: 100px; overflow-y: auto;"></div>
    </div>

    <script>
        let isEnglish = true;

        function showModal() {
            document.getElementById('modal').style.display = 'flex';
        }

        function toggleLanguage() {
            isEnglish = !isEnglish;
            document.getElementById('content-en').style.display = isEnglish ? 'block' : 'none';
            document.getElementById('content-jp').style.display = isEnglish ? 'none' : 'block';
            document.getElementById('label-bpm').innerText = isEnglish ? 'BPM:' : 'BPM:';
            document.getElementById('label-hi-speed').innerText = isEnglish ? 'HI-SPEED:' : 'HI-SPEED:';
            document.getElementById('label-green').innerText = isEnglish ? 'Green Number (IIDX equivalent):' : '緑数字（弐寺相当）:';
            document.getElementById('label-note-adjust').innerText = isEnglish ? 'Note Display Adjustment:' : 'ノーツ表示調整:';
            document.getElementById('label-judge-line').innerText = isEnglish ? 'Judgment Line Position:' : '判定ライン位置:';
            document.getElementById('label-shutter-in').innerText = isEnglish ? 'SHUTTER (IN):' : 'SHUTTER (IN):';
            document.getElementById('label-shutter-out').innerText = isEnglish ? 'SHUTTER (OUT):' : 'SHUTTER (OUT):';
            document.getElementById('label-refresh-rate').innerText = isEnglish ? 'Refresh Rate (Hz):' : 'リフレッシュレート (Hz):';
            document.getElementById('label-monitor-delay').innerText = isEnglish ? 'Monitor Delay (ms):' : 'モニター遅延 (ms):';
            document.getElementById('label-white').innerText = isEnglish ? 'White Number (IIDX equivalent):' : '白数字（弐寺相当）:';
            document.getElementById('log-title').innerText = isEnglish ? 'Change Log' : '変更履歴';
        }

        function adjustValue(id, delta) {
            const input = document.getElementById(id);
            let value = parseFloat(input.value) + delta;
            if (id === 'bpm') value = Math.max(78, Math.min(400, Math.round(value)));
            if (id === 'green-number') value = Math.max(0, value.toFixed(1));
            input.value = value;
            logChange(id === 'bpm' ? 'BPM' : 'Green Number', value);
            calculateSettings();
            saveSettings();
        }

        function adjustHiSpeedValue(delta) {
            const input = document.getElementById('hi-speed');
            let value = parseFloat(input.value) + delta;
            value = Math.max(0.5, Math.min(10.0, Math.round(value * 4) / 4));
            input.value = value.toFixed(2);
            logChange('HI-SPEED', value);
            calculateSettings();
            saveSettings();
        }

        function adjustHiSpeed() {
            const input = document.getElementById('hi-speed');
            let value = parseFloat(input.value);
            value = Math.max(0.5, Math.min(10.0, Math.round(value * 4) / 4));
            input.value = value.toFixed(2);
            logChange('HI-SPEED', value);
            calculateSettings();
            saveSettings();
        }

        function logChange(field, value) {
            const log = document.getElementById('change-log');
            const timestamp = new Date().toLocaleString();
            const entry = `[${timestamp}] ${field}: ${value}<br>`;
            log.innerHTML = entry + log.innerHTML;
        }

        function saveSettings() {
            const settings = {
                bpm: document.getElementById('bpm').value,
                hiSpeed: document.getElementById('hi-speed').value,
                greenNumber: document.getElementById('green-number').value,
                noteAdjust: document.getElementById('note-adjust').value,
                judgeLine: document.getElementById('judge-line').value,
                shutterIn: document.getElementById('shutter-in').value
            };
            localStorage.setItem('gitadoraSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('gitadoraSettings'));
            if (settings) {
                document.getElementById('bpm').value = settings.bpm || 180;
                document.getElementById('hi-speed').value = settings.hiSpeed || 3.75;
                document.getElementById('green-number').value = settings.greenNumber || 320;
                document.getElementById('note-adjust').value = settings.noteAdjust || -6;
                document.getElementById('judge-line').value = settings.judgeLine || 8;
                document.getElementById('shutter-in').value = settings.shutterIn || 25;
            }
            calculateSettings();
        }

        function interpolateHiSpeed(bpm) {
            const points = [
                { bpm: 78, hiSpeed: 8.5 },
                { bpm: 180, hiSpeed: 3.75 },
                { bpm: 400, hiSpeed: 1.5 }
            ];
            if (bpm <= 78) return 8.5;
            if (bpm >= 400) return 1.5;
            for (let i = 0; i < points.length - 1; i++) {
                if (bpm >= points[i].bpm && bpm <= points[i + 1].bpm) {
                    const t = (bpm - points[i].bpm) / (points[i + 1].bpm - points[i].bpm);
                    return points[i].hiSpeed + t * (points[i + 1].hiSpeed - points[i].hiSpeed);
                }
            }
        }

        function calculateSettings() {
            const bpm = parseFloat(document.getElementById('bpm').value);
            const hiSpeed = parseFloat(document.getElementById('hi-speed').value);
            const greenNumber = parseFloat(document.getElementById('green-number').value);
            const refreshRate = 60;
            const monitorDelay = 9;

            // Base HI-SPEED for the given BPM
            const baseHiSpeed = interpolateHiSpeed(bpm);
            const baseGreen = 320; // Approximate green number for BPM 180, HI-SPEED 3.75

            // Calculate green number if BPM or HI-SPEED changes
            let newGreen = greenNumber;
            if (document.activeElement.id !== 'green-number') {
                newGreen = baseGreen * (180 / bpm) * (hiSpeed / 3.75);
                document.getElementById('green-number').value = newGreen.toFixed(1);
            }

            // Calculate HI-SPEED if green number changes
            let newHiSpeed = hiSpeed;
            if (document.activeElement.id === 'green-number') {
                newHiSpeed = (greenNumber / baseGreen) * (bpm / 180) * 3.75;
                newHiSpeed = Math.max(0.5, Math.min(10.0, Math.round(newHiSpeed * 4) / 4));
                document.getElementById('hi-speed').value = newHiSpeed.toFixed(2);
            }

            // Calculate note display adjustment
            const noteAdjust = -6 * (bpm / 180) * (newHiSpeed / 3.75);
            document.getElementById('note-adjust').value = Math.max(-20, Math.min(20, Math.round(noteAdjust)));

            // Calculate judgment line position and shutter in (simplified)
            const judgeLine = 8; // Fixed for simplicity
            const shutterIn = 25; // Fixed for simplicity
            document.getElementById('judge-line').value = judgeLine;
            document.getElementById('shutter-in').value = shutterIn;

            // White number (placeholder, as per IIDX equivalent)
            document.getElementById('white-number').value = 0;
        }
    </script>
</body>
</html>
