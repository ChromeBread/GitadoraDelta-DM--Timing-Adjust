<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f0f0f0;
            font-size: 16px;
            line-height: 1.5;
            overflow-x: hidden;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            font-size: 1.2em;
            text-align: center;
            margin: 0.5em 0;
        }
        h2 {
            font-size: 1em;
            text-align: center;
            color: #555;
            margin-bottom: 1em;
        }
        .lang-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .input-group {
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        label {
            flex: 1;
            font-size: 0.9em;
        }
        input, button {
            font-size: 0.9em;
        }
        input[type="number"] {
            width: 80px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: right;
        }
        .button-group {
            display: flex;
            gap: 5px;
        }
        button {
            padding: 5px 10px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .notes {
            font-size: 0.8em;
            color: #333;
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }
        .log {
            font-size: 8%;
            color: #666;
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 10px;
            word-wrap: break-word;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 80%;
        }
        .modal-content p {
            font-weight: bold;
            font-size: 1em;
            margin-bottom: 20px;
        }
        @media (max-width: 600px) {
            body {
                font-size: 14px;
            }
            h1 {
                font-size: 1em;
            }
            h2 {
                font-size: 0.9em;
            }
            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }
            input[type="number"] {
                width: 100%;
                margin: 5px 0;
            }
            .button-group {
                width: 100%;
                justify-content: space-between;
            }
            button {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <button class="lang-toggle" onclick="toggleLanguage()">日本語</button>
    <div class="modal" id="modal">
        <div class="modal-content">
            <p id="modal-text">
                For sight-readers or new players only<br>
                Tap OK to proceed
            </p>
            <button onclick="closeModal()">OK</button>
        </div>
    </div>
    <div class="container">
        <h1 id="title">GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</h1>
        <h2 id="subtitle">Set the shutter top as the judgment line to disable delay.</h2>
        <div class="input-group">
            <label for="bpm">BPM:</label>
            <div class="button-group">
                <button onclick="adjustValue('bpm', -1)">-</button>
                <input type="number" id="bpm" value="180" step="1" min="1">
                <button onclick="adjustValue('bpm', 1)">+</button>
            </div>
        </div>
        <div class="input-group">
            <label for="hiSpeed">HI-SPEED:</label>
            <div class="button-group">
                <button onclick="adjustValue('hiSpeed', -0.25)">-</button>
                <input type="number" id="hiSpeed" value="3.75" step="0.25" min="0.5" max="10">
                <button onclick="adjustValue('hiSpeed', 0.25)">+</button>
            </div>
        </div>
        <div class="input-group">
            <label for="greenNumber">Green Number:</label>
            <div class="button-group">
                <button onclick="adjustValue('greenNumber', -1)">-</button>
                <input type="number" id="greenNumber" step="1">
                <button onclick="adjustValue('greenNumber', 1)">+</button>
            </div>
        </div>
        <div class="input-group">
            <label for="noteAdjustment">Note Display Adjustment:</label>
            <input type="number" id="noteAdjustment" value="-6" readonly>
        </div>
        <div class="input-group">
            <label for="judgmentLine">Judgment Line Position:</label>
            <input type="number" id="judgmentLine" value="8" readonly>
        </div>
        <div class="input-group">
            <label for="shutterIn">SHUTTER (IN):</label>
            <input type="number" id="shutterIn" value="25" readonly>
        </div>
        <div class="input-group">
            <label for="shutterOut">SHUTTER (OUT):</label>
            <input type="number" id="shutterOut" value="16" readonly>
        </div>
        <div class="input-group">
            <label for="refreshRate">Refresh Rate (Hz):</label>
            <input type="number" id="refreshRate" value="60" readonly>
        </div>
        <div class="input-group">
            <label for="monitorDelay">Monitor Delay (ms):</label>
            <input type="number" id="monitorDelay" value="9" readonly>
        </div>
        <div class="notes" id="notes">
            <strong>Notes:</strong><br>
            - SHUTTER (OUT) is fixed to align the judgment line.<br>
            - Konaste HI-SPEED adjustments are in 0.5 increments.<br>
            - GITADORA GALAXY WAVE DELTA's default monitor has a 9ms delay.<br>
            - Audio depth balance varies by song; assume zero audio delay with headphones.<br>
            - HI-SPEED: 3.75 at BPM: 180 is the limit to prevent note flicker.
        </div>
        <div class="log" id="log"></div>
    </div>
    <script>
        const translations = {
            en: {
                langButton: "日本語",
                modalText: "For sight-readers or new players only<br>Tap OK to proceed",
                title: "GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)",
                subtitle: "Set the shutter top as the judgment line to disable delay.",
                bpm: "BPM:",
                hiSpeed: "HI-SPEED:",
                greenNumber: "Green Number:",
                noteAdjustment: "Note Display Adjustment:",
                judgmentLine: "Judgment Line Position:",
                shutterIn: "SHUTTER (IN):",
                shutterOut: "SHUTTER (OUT):",
                refreshRate: "Refresh Rate (Hz):",
                monitorDelay: "Monitor Delay (ms):",
                notes: `<strong>Notes:</strong><br>
                    - SHUTTER (OUT) is fixed to align the judgment line.<br>
                    - Konaste HI-SPEED adjustments are in 0.5 increments.<br>
                    - GITADORA GALAXY WAVE DELTA's default monitor has a 9ms delay.<br>
                    - Audio depth balance varies by song; assume zero audio delay with headphones.<br>
                    - HI-SPEED: 3.75 at BPM: 180 is the limit to prevent note flicker.`
            },
            jp: {
                langButton: "English",
                modalText: "目押し勢 or 新規プレイヤー<br>どちらかに該当する方のみ<br>OKボタンをタップ",
                title: "GITADORA GALAXY WAVE DELTA Drummania設定ジェネレーター（非公式）",
                subtitle: "シャッター上部を判定ラインとして設定し、遅延を無効化します。",
                bpm: "BPM：",
                hiSpeed: "HI-SPEED：",
                greenNumber: "緑数字：",
                noteAdjustment: "ノーツ表示調整：",
                judgmentLine: "判定ライン位置：",
                shutterIn: "SHUTTER (IN)：",
                shutterOut: "SHUTTER (OUT)：",
                refreshRate: "リフレッシュレート（Hz）：",
                monitorDelay: "モニター遅延（ms）：",
                notes: `<strong>注意書き：</strong><br>
                    - SHUTTER (OUT)は判定ラインを揃えるため固定されています。<br>
                    - コナステのHI-SPEED調整は0.5単位です。<br>
                    - GITADORA GALAXY WAVE DELTAの初期出荷モニターは遅延9msです。<br>
                    - 各スピーカーから出る音の奥行バランスが曲によって異なるため、ヘッドホンを装着して音声遅延が0であると仮定します。<br>
                    - HI-SPEED: 3.75 BPM: 180はノーツがぶれない限度です。`
            }
        };

        let currentLang = localStorage.getItem('language') || 'en';
        let logEntries = JSON.parse(localStorage.getItem('logEntries')) || [];

        function applyLanguage() {
            document.querySelector('.lang-toggle').textContent = translations[currentLang].langButton;
            document.getElementById('modal-text').innerHTML = translations[currentLang].modalText;
            document.getElementById('title').textContent = translations[currentLang].title;
            document.getElementById('subtitle').textContent = translations[currentLang].subtitle;
            document.querySelector('label[for="bpm"]').textContent = translations[currentLang].bpm;
            document.querySelector('label[for="hiSpeed"]').textContent = translations[currentLang].hiSpeed;
            document.querySelector('label[for="greenNumber"]').textContent = translations[currentLang].greenNumber;
            document.querySelector('label[for="noteAdjustment"]').textContent = translations[currentLang].noteAdjustment;
            document.querySelector('label[for="judgmentLine"]').textContent = translations[currentLang].judgmentLine;
            document.querySelector('label[for="shutterIn"]').textContent = translations[currentLang].shutterIn;
            document.querySelector('label[for="shutterOut"]').textContent = translations[currentLang].shutterOut;
            document.querySelector('label[for="refreshRate"]').textContent = translations[currentLang].refreshRate;
            document.querySelector('label[for="monitorDelay"]').textContent = translations[currentLang].monitorDelay;
            document.getElementById('notes').innerHTML = translations[currentLang].notes;
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'jp' : 'en';
            localStorage.setItem('language', currentLang);
            applyLanguage();
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.querySelector('.container').style.pointerEvents = 'auto';
        }

        function calculateSettings(bpm, hiSpeed, isGreenNumberInput = false) {
            const refreshRate = 60;
            const monitorDelay = 9;
            let greenNumber, noteAdjustment, judgmentLine, shutterIn;

            if (!isGreenNumberInput) {
                // Calculate green number from BPM and HI-SPEED
                greenNumber = ((60000 / bpm / hiSpeed) * (60 / refreshRate) - monitorDelay) / 0.01666;
                greenNumber = Math.round(greenNumber);
            } else {
                // Reverse calculate BPM from green number
                greenNumber = parseFloat(document.getElementById('greenNumber').value);
                bpm = 60000 / (hiSpeed * (greenNumber * 0.01666 + monitorDelay) * refreshRate / 60);
                bpm = Math.round(bpm);
                document.getElementById('bpm').value = bpm;
            }

            // Calculate dependent settings
            noteAdjustment = -6 * (180 / bpm) * (3.75 / hiSpeed);
            noteAdjustment = Math.max(-20, Math.min(20, Math.round(noteAdjustment * 10) / 10));
            judgmentLine = 8 * (3.75 / hiSpeed);
            judgmentLine = Math.round(judgmentLine * 10) / 10;
            shutterIn = 25 * (3.75 / hiSpeed);
            shutterIn = Math.round(shutterIn * 10) / 10;

            // Update inputs
            document.getElementById('greenNumber').value = greenNumber;
            document.getElementById('noteAdjustment').value = noteAdjustment;
            document.getElementById('judgmentLine').value = judgmentLine;
            document.getElementById('shutterIn').value = shutterIn;

            // Save to local storage
            localStorage.setItem('bpm', bpm);
            localStorage.setItem('hiSpeed', hiSpeed);
            localStorage.setItem('greenNumber', greenNumber);
            localStorage.setItem('noteAdjustment', noteAdjustment);
            localStorage.setItem('judgmentLine', judgmentLine);
            localStorage.setItem('shutterIn', shutterIn);

            // Log changes
            const timestamp = new Date().toLocaleString('ja-JP');
            const logEntry = `[${timestamp}] BPM: ${bpm}, HI-SPEED: ${hiSpeed}, Green Number: ${greenNumber}`;
            logEntries.push(logEntry);
            if (logEntries.length > 50) logEntries.shift(); // Limit log size
            localStorage.setItem('logEntries', JSON.stringify(logEntries));
            document.getElementById('log').textContent = logEntries.join('\n');
        }

        function adjustValue(id, delta) {
            const input = document.getElementById(id);
            let value = parseFloat(input.value) + delta;
            if (id === 'hiSpeed') {
                value = Math.max(0.5, Math.min(10, Math.round(value * 4) / 4));
            } else if (id === 'bpm') {
                value = Math.max(1, Math.round(value));
            } else if (id === 'greenNumber') {
                value = Math.round(value);
            }
            input.value = value;
            calculateSettings(
                parseFloat(document.getElementById('bpm').value),
                parseFloat(document.getElementById('hiSpeed').value),
                id === 'greenNumber'
            );
        }

        // Initialize
        document.querySelector('.container').style.pointerEvents = 'none';
        applyLanguage();

        // Load saved settings
        document.getElementById('bpm').value = localStorage.getItem('bpm') || 180;
        document.getElementById('hiSpeed').value = localStorage.getItem('hiSpeed') || 3.75;
        calculateSettings(
            parseFloat(document.getElementById('bpm').value),
            parseFloat(document.getElementById('hiSpeed').value)
        );
        document.getElementById('log').textContent = logEntries.join('\n');

        // Event listeners
        document.getElementById('bpm').addEventListener('change', () => {
            let value = parseFloat(document.getElementById('bpm').value);
            value = Math.max(1, Math.round(value));
            document.getElementById('bpm').value = value;
            calculateSettings(value, parseFloat(document.getElementById('hiSpeed').value));
        });

        document.getElementById('hiSpeed').addEventListener('change', () => {
            let value = parseFloat(document.getElementById('hiSpeed').value);
            value = Math.max(0.5, Math.min(10, Math.round(value * 4) / 4));
            document.getElementById('hiSpeed').value = value;
            calculateSettings(parseFloat(document.getElementById('bpm').value), value);
        });

        document.getElementById('greenNumber').addEventListener('change', () => {
            calculateSettings(
                parseFloat(document.getElementById('bpm').value),
                parseFloat(document.getElementById('hiSpeed').value),
                true
            );
        });
    </script>
</body>
</html>
