<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
            font-size: 16px;
            line-height: 1.5;
            max-width: 100%;
            overflow-x: hidden;
        }
        h1 {
            font-size: 24px;
            text-align: center;
            margin-bottom: 10px;
        }
        h2 {
            font-size: 18px;
            text-align: center;
            color: #666;
            margin-bottom: 20px;
        }
        .lang-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #007aff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .section {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: #007aff;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            font-weight: bold;
            margin-top: 10px;
            font-size: 18px;
            text-align: center;
        }
        .history {
            font-size: 8%;
            color: #999;
            text-align: center;
            margin-top: 20px;
            word-wrap: break-word;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .overlay-message {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 80%;
        }
        .overlay-message p {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 20px;
        }
        .overlay-message button {
            background: #007aff;
            padding: 10px 20px;
            font-size: 16px;
        }
        @media (max-width: 414px) {
            body {
                padding: 10px;
            }
            h1 {
                font-size: 20px;
            }
            h2 {
                font-size: 16px;
            }
            .section {
                padding: 10px;
            }
            input[type="number"], button {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <button class="lang-toggle" onclick="toggleLanguage()">日本語</button>
    <h1 data-en="GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)" data-jp="GITADORA GALAXY WAVE DELTA ドラムマニア設定ジェネレーター（非公式）">GITADORA GALAXY WAVE DELTA Drummania Settings Generator (unofficial)</h1>
    <h2 data-en="Set the shutter top as the judgment line to disable delay." data-jp="シャッターの上部を判定ラインとして設定し、遅延を無効にします。">Set the shutter top as the judgment line to disable delay.</h2>

    <div class="section">
        <h3 data-en="Description" data-jp="説明">Description</h3>
        <p data-en="This tool calculates the 'green number' (similar to Beatmania IIDX) for GITADORA GALAXY WAVE DELTA Drummania settings, helping you adjust timing for optimal play. Input your settings to get the green number or reverse-calculate settings from a desired green number." data-jp="このツールは、GITADORA GALAXY WAVE DELTA ドラムマニアの設定に基づいて、ビートマニアIIDXの「緑数字」に相当する値を計算し、最適なプレイのためのタイミング調整を支援します。設定を入力して緑数字を取得するか、希望する緑数字から設定を逆算できます。"></p>
    </div>

    <div class="section">
        <h3 data-en="Settings" data-jp="設定">Settings</h3>
        <div class="input-group">
            <label data-en="HI-SPEED (0.25 increments)" data-jp="HI-SPEED（0.25単位）">HI-SPEED (0.25 increments)</label>
            <input type="number" id="hiSpeed" step="0.25" min="0.25" value="3.75">
            <div class="button-group">
                <button onclick="adjustValue('hiSpeed', -0.25)">-</button>
                <button onclick="adjustValue('hiSpeed', 0.25)">+</button>
            </div>
        </div>
        <div class="input-group">
            <label data-en="Note Display Adjustment" data-jp="ノーツ表示調整">Note Display Adjustment</label>
            <input type="number" id="noteAdjust" value="-6">
            <div class="button-group">
                <button onclick="adjustValue('noteAdjust', -1)">-</button>
                <button onclick="adjustValue('noteAdjust', 1)">+</button>
            </div>
        </div>
        <div class="input-group">
            <label data-en="Judgment Line Position" data-jp="判定ライン位置">Judgment Line Position</label>
            <input type="number" id="judgeLine" value="8">
            <div class="button-group">
                <button onclick="adjustValue('judgeLine', -1)">-</button>
                <button onclick="adjustValue('judgeLine', 1)">+</button>
            </div>
        </div>
        <div class="input-group">
            <label data-en="SHUTTER (IN)" data-jp="SHUTTER (IN)">SHUTTER (IN)</label>
            <input type="number" id="shutterIn" value="25">
            <div class="button-group">
                <button onclick="adjustValue('shutterIn', -1)">-</button>
                <button onclick="adjustValue('shutterIn', 1)">+</button>
            </div>
        </div>
        <div class="input-group">
            <label data-en="SHUTTER (OUT, fixed)" data-jp="SHUTTER (OUT, 固定)">SHUTTER (OUT, fixed)</label>
            <input type="number" id="shutterOut" value="16" disabled>
        </div>
        <div class="input-group">
            <label data-en="Refresh Rate (fixed)" data-jp="リフレッシュレート（固定）">Refresh Rate (fixed)</label>
            <input type="number" id="refreshRate" value="60" disabled>
        </div>
        <button onclick="calculateGreenNumber()" data-en="Calculate Green Number" data-jp="緑数字を計算">Calculate Green Number</button>
        <div class="result" id="result"></div>
    </div>

    <div class="section">
        <h3 data-en="Reverse Calculation" data-jp="逆算">Reverse Calculation</h3>
        <div class="input-group">
            <label data-en="Desired Green Number (ms)" data-jp="希望する緑数字（ms）">Desired Green Number (ms)</label>
            <input type="number" id="desiredGreen" min="0">
            <div class="button-group">
                <button onclick="adjustValue('desiredGreen', -1)">-</button>
                <button onclick="adjustValue('desiredGreen', 1)">+</button>
            </div>
        </div>
        <button onclick="reverseCalculate()" data-en="Calculate Settings" data-jp="設定を計算">Calculate Settings</button>
        <div class="result" id="reverseResult"></div>
    </div>

    <div class="section">
        <h3 data-en="Notes" data-jp="注意書き">Notes</h3>
        <ul>
            <li data-en="Konaste HI-SPEED adjustments are in 0.5 increments." data-jp="コナステのHI-SPEED調整は0.5単位です。"></li>
            <li data-en="The default monitor for GITADORA GALAXY WAVE DELTA has a 9ms delay." data-jp="GITADORA GALAXY WAVE DELTAの初期出荷モニターは遅延9msです。"></li>
            <li data-en="Due to varying sound depth balance across songs, assume zero audio delay with headphones." data-jp="各スピーカーから出る音の奥行バランスが曲によって異なるため、ヘッドホンを装着して音声遅延が0であると仮定します。"></li>
            <li data-en="HI-SPEED: X 3.75, BPM: 180 is the limit to prevent note wobble." data-jp="HI-SPEED: X 3.75、BPM: 180はノーツがぶれない限度です。"></li>
        </ul>
    </div>

    <div class="history" id="history"></div>

    <div class="overlay" id="overlay">
        <div class="overlay-message">
            <p data-en="For visual timing players or new players only<br>Tap the blue button" data-jp="目押し勢 or 新規プレイヤー<br>どちらかに該当する方のみ<br>青ボタンをタップ">For visual timing players or new players only<br>Tap the blue button</p>
            <button onclick="dismissOverlay()">OK</button>
        </div>
    </div>

    <script>
        let language = 'en';
        let history = [];

        function toggleLanguage() {
            language = language === 'en' ? 'jp' : 'en';
            document.querySelector('.lang-toggle').textContent = language === 'en' ? '日本語' : 'English';
            updateText();
            saveSettings();
        }

        function updateText() {
            document.querySelectorAll('[data-en]').forEach(el => {
                el.textContent = el.getAttribute(`data-${language}`);
            });
        }

        function dismissOverlay() {
            document.getElementById('overlay').style.display = 'none';
            document.body.style.pointerEvents = 'auto';
        }

        function adjustValue(id, delta) {
            const input = document.getElementById(id);
            const value = parseFloat(input.value) + delta;
            if (id === 'hiSpeed' && value >= 0.25) {
                input.value = value.toFixed(2);
            } else if (id !== 'hiSpeed' && Number.isInteger(value)) {
                input.value = value;
            }
            calculateGreenNumber();
            saveSettings();
        }

        function calculateGreenNumber() {
            const hiSpeed = parseFloat(document.getElementById('hiSpeed').value);
            const noteAdjust = parseInt(document.getElementById('noteAdjust').value);
            const judgeLine = parseInt(document.getElementById('judgeLine').value);
            const shutterIn = parseInt(document.getElementById('shutterIn').value);
            const frameTime = 1000 / 60; // 60Hz = 16.67ms
            const monitorDelay = 9; // 9ms

            const timingShift = noteAdjust * frameTime;
            const lineOffset = judgeLine * frameTime;
            const shutterOffset = shutterIn * frameTime;

            const greenNumber = (shutterOffset - timingShift + lineOffset - monitorDelay) / hiSpeed;
            const resultText = language === 'en' 
                ? `Green Number: ${greenNumber.toFixed(2)} ms`
                : `緑数字: ${greenNumber.toFixed(2)} ms`;
            document.getElementById('result').textContent = resultText;

            logHistory(`Calculated Green Number: ${greenNumber.toFixed(2)} ms with HI-SPEED=${hiSpeed}, NoteAdjust=${noteAdjust}, JudgeLine=${judgeLine}, ShutterIn=${shutterIn}`);
        }

        function reverseCalculate() {
            const desiredGreen = parseFloat(document.getElementById('desiredGreen').value);
            const noteAdjust = parseInt(document.getElementById('noteAdjust').value);
            const judgeLine = parseInt(document.getElementById('judgeLine').value);
            const shutterIn = parseInt(document.getElementById('shutterIn').value);
            const frameTime = 1000 / 60;
            const monitorDelay = 9;

            const timingShift = noteAdjust * frameTime;
            const lineOffset = judgeLine * frameTime;
            const suggestedHiSpeed = (shutterIn * frameTime - timingShift + lineOffset - monitorDelay) / desiredGreen;

            let resultText;
            if (suggestedHiSpeed >= 0.25) {
                resultText = language === 'en'
                    ? `Suggested HI-SPEED: ${suggestedHiSpeed.toFixed(2)} (adjust to nearest 0.5 for Konaste)`
                    : `推奨HI-SPEED: ${suggestedHiSpeed.toFixed(2)}（コナステでは0.5単位に調整）`;
            } else {
                resultText = language === 'en'
                    ? `No valid HI-SPEED (must be ≥ 0.25)`
                    : `有効なHI-SPEEDなし（0.25以上でなければならない）`;
            }
            document.getElementById('reverseResult').textContent = resultText;

            logHistory(`Reverse Calculated HI-SPEED: ${suggestedHiSpeed.toFixed(2)} for Green Number=${desiredGreen} ms`);
        }

        function logHistory(message) {
            const timestamp = new Date().toLocaleString();
            history.push(`[${timestamp}] ${message}`);
            if (history.length > 10) history.shift();
            document.getElementById('history').textContent = history.join('\n');
            saveSettings();
        }

        function saveSettings() {
            const settings = {
                hiSpeed: document.getElementById('hiSpeed').value,
                noteAdjust: document.getElementById('noteAdjust').value,
                judgeLine: document.getElementById('judgeLine').value,
                shutterIn: document.getElementById('shutterIn').value,
                language: language,
                history: history
            };
            localStorage.setItem('gitadoraSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('gitadoraSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('hiSpeed').value = settings.hiSpeed;
                document.getElementById('noteAdjust').value = settings.noteAdjust;
                document.getElementById('judgeLine').value = settings.judgeLine;
                document.getElementById('shutterIn').value = settings.shutterIn;
                language = settings.language;
                history = settings.history || [];
                document.querySelector('.lang-toggle').textContent = language === 'en' ? '日本語' : 'English';
                update
